<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Clientes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #007bff;
            --primary-hover: #0056b3;
            --bg-color: #fff;
            --text-color: #333;
            --border-color: #e0e0e0;
            --hover-bg: #f5f5f5;
            --expired-color: #d32f2f;
            --expiring-color: #f57c00;
            --in-day-color: #28a745;
            --toast-success: #28a745;
            --toast-error: #dc3545;
            --theme-btn-color: #28a745;
            --theme-btn-hover: #218838;
            --panel-btn-color: #6f42c1;
            --panel-btn-hover: #5a32a3;
            --msg-btn-color: #17a2b8;
            --msg-btn-hover: #138496;
            --input-bg: #f9f9f9;
            --variable-bg: #e9ecef;
            --modal-header-bg: linear-gradient(135deg, #007bff, #00d4ff);
            --panel-modal-header-bg: linear-gradient(135deg, #6f42c1, #9b59b6);
            --msg-modal-header-bg: linear-gradient(135deg, #17a2b8, #45b7d1);
            --scrollbar-color: #888;
            --scrollbar-bg: #f1f1f1;
        }

        [data-theme="dark"] {
            --bg-color: #1e1e1e;
            --text-color: #e0e0e0;
            --border-color: #444;
            --hover-bg: #333;
            --primary-color: #4a90e2;
            --primary-hover: #357abd;
            --toast-success: #2e7d32;
            --toast-error: #d81b60;
            --theme-btn-color: #2e7d32;
            --theme-btn-hover: #1b5e20;
            --panel-btn-color: #5a32a3;
            --panel-btn-hover: #462585;
            --msg-btn-color: #48c9b0;
            --msg-btn-hover: #36a39b;
            --input-bg: #2a2a2a;
            --variable-bg: #2e2e2e;
            --modal-header-bg: linear-gradient(135deg, #4a90e2, #6ab0ff);
            --panel-modal-header-bg: linear-gradient(135deg, #5a32a3, #7d4bc8);
            --msg-modal-header-bg: linear-gradient(135deg, #48c9b0, #5eead4);
            --scrollbar-color: #555;
            --scrollbar-bg: #333;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: clamp(10px, 3vw, 20px);
            transition: background-color 0.3s, color 0.3s;
            font-size: min(1rem, 3vw);
            box-sizing: border-box;
        }

        #clientTable {
            width: 100%;
            background-color: var(--bg-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
            margin-top: clamp(10px, 3vw, 20px);
            max-width: 100%;
        }

        .group-header {
            background-color: var(--primary-color);
            color: #fff;
            font-weight: 600;
            padding: clamp(8px, 2vw, 10px) clamp(10px, 3vw, 16px);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .group-header.vencidos { background-color: var(--expired-color); }
        .group-header.vencendo { background-color: var(--expiring-color); }
        .group-header.em-dia { background-color: var(--in-day-color); }
        .group-header.todos { background-color: #6c757d; }

        .client-count {
            background: rgba(255, 255, 255, 0.3);
            padding: clamp(2px, 0.5vw, 4px) clamp(8px, 2vw, 10px);
            border-radius: 12px;
            font-size: min(0.85em, 2.5vw);
            margin-left: clamp(8px, 2vw, 10px);
        }

        .group-content {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.5s ease, opacity 0.5s ease;
        }

        .group-content.open {
            max-height: 1000px;
            opacity: 1;
            animation: slideDown 0.5s ease forwards;
        }

        @keyframes slideDown {
            from { max-height: 0; opacity: 0; }
            to { max-height: 1000px; opacity: 1; }
        }

        .client-row {
            padding: clamp(8px, 2vw, 12px) clamp(10px, 3vw, 16px);
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .client-row:hover { background-color: var(--hover-bg); }

        .client-details {
            display: none;
            padding: clamp(6px, 2vw, 10px) clamp(12px, 3vw, 20px);
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.5s ease, opacity 0.5s ease;
        }

        .client-details.open {
            display: block;
            max-height: 500px;
            opacity: 1;
            animation: slideDownDetails 0.5s ease forwards;
        }

        @keyframes slideDownDetails {
            from { max-height: 0; opacity: 0; }
            to { max-height: 500px; opacity: 1; }
        }

        #todos-content .client-details {
            display: block;
            max-height: 500px;
            opacity: 1;
        }

        .client-info {
            display: flex;
            align-items: center;
            gap: clamp(6px, 2vw, 10px);
        }

        .client-info .due-date {
            font-size: min(0.9em, 2.5vw);
            color: var(--text-color);
        }

        .actions {
            display: flex;
            gap: clamp(6px, 2vw, 10px);
            flex-wrap: wrap;
        }

        .actions button, .actions a {
            padding: clamp(6px, 2vw, 8px) clamp(8px, 2.5vw, 12px);
            border: none;
            border-radius: 5px;
            background-color: var(--primary-color);
            color: #fff;
            text-decoration: none;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-size: min(0.9em, 2.5vw);
        }

        .actions button:hover, .actions a:hover {
            background-color: var(--primary-hover);
        }

        .actions .due-alert {
            background-color: var(--expiring-color);
        }

        .actions .due-alert:hover {
            background-color: #e65100;
        }

        .client-actions {
            display: flex;
            gap: clamp(6px, 2vw, 8px);
        }

        .whatsapp-btn, .renew-btn {
            background-color:#37C952 ;
            color: #646464;
            padding: clamp(4px, 1.5vw, 6px) clamp(6px, 2vw, 10px);
            border-radius: 5px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: clamp(4px, 1vw, 5px);
            font-size: min(0.9em, 2.5vw);
        }

        .whatsapp-btn:hover, .renew-btn:hover {
            background-color: #00DEE6;
        }

        #modal, #panelManagerModal, #messageManagerModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #modal[style*="flex"], #panelManagerModal[style*="flex"], #messageManagerModal[style*="flex"] {
            opacity: 1;
        }

        .modal-content {
            background-color: var(--bg-color);
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            transform: translateY(-20px);
            transition: transform 0.3s ease, background-color 0.3s;
            position: relative;
            overflow: hidden;
        }

        #modal[style*="flex"] .modal-content, #panelManagerModal[style*="flex"] .modal-content, #messageManagerModal[style*="flex"] .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            background: var(--modal-header-bg);
            padding: clamp(10px, 2.5vw, 15px) clamp(15px, 3vw, 20px);
            text-align: center;
        }

        #panelManagerModal .modal-header {
            background: var(--panel-modal-header-bg);
        }

        #messageManagerModal .modal-header {
            background: var(--msg-modal-header-bg);
        }

        .modal-header h2 {
            margin: 0;
            font-size: min(1.6em, 5vw);
            color: #fff;
        }

        .modal-body {
            padding: clamp(15px, 3vw, 20px);
        }

        .modal-content form {
            display: flex;
            flex-direction: column;
            gap: clamp(12px, 3vw, 18px);
        }

        .input-group {
            padding-left: 30px;
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-group i {
            position: absolute;
            left: 6px;
            color: var(--primary-color);
            font-size: min(1.2em, 3.5vw);
            z-index: 1;
        }

        #panelManagerModal .input-group i, #messageManagerModal .input-group i {
            color: var(--panel-btn-color);
        }

        .modal-content input, .modal-content select, .modal-content textarea {
            padding: clamp(10px, 2.5vw, 12px) clamp(10px, 2.5vw, 12px) clamp(10px, 2.5vw, 12px) clamp(30px, 7vw, 35px);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: min(1em, 3vw);
            background-color: var(--input-bg);
            color: var(--text-color);
            width: 100%;
            transition: border-color 0.2s ease;
        }

        .modal-content input:focus, .modal-content select:focus, .modal-content textarea:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        #panelManagerModal .modal-content input:focus, #panelManagerModal .modal-content select:focus,
        #messageManagerModal .modal-content textarea:focus {
            border-color: var(--panel-btn-color);
        }

        .modal-content textarea {
            resize: vertical;
            min-height: clamp(80px, 20vw, 100px);
        }

        .modal-content button[type="submit"] {
            padding: clamp(10px, 2.5vw, 12px);
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
            color: #fff;
            cursor: pointer;
            font-size: min(1.1em, 3.5vw);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: clamp(6px, 2vw, 8px);
            transition: transform 0.2s ease, background 0.2s ease;
        }

        #panelManagerModal .modal-content button[type="submit"],
        #messageManagerModal .modal-content button[type="submit"] {
            background: linear-gradient(135deg, var(--panel-btn-color), var(--panel-btn-hover));
        }

        .modal-content button[type="submit"]:hover {
            transform: scale(1.02);
            background: linear-gradient(135deg, var(--primary-hover), var(--primary-color));
        }

        #panelManagerModal .modal-content button[type="submit"]:hover,
        #messageManagerModal .modal-content button[type="submit"]:hover {
            background: linear-gradient(135deg, var(--panel-btn-hover), var(--panel-btn-color));
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: min(1.4em, 4vw);
            cursor: pointer;
            color: #fff;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 50%;
            width: clamp(25px, 6vw, 30px);
            height: clamp(25px, 6vw, 30px);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s ease;
        }

        .close-btn:hover {
            background: rgba(0, 0, 0, 0.5);
        }

        #panelList {
            list-style: none;
            padding: clamp(10px, 2vw, 15px);
            margin-top: clamp(10px, 3vw, 20px);
            max-height: clamp(200px, 50vh, 400px);
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 4fr));
            gap: clamp(10px, 2vw, 15px);
            scrollbar-width: thin;
            scrollbar-color: var(--scrollbar-color) var(--scrollbar-bg);
        }

        #panelList::-webkit-scrollbar {
            width: 8px;
        }

        #panelList::-webkit-scrollbar-track {
            background: var(--scrollbar-bg);
            border-radius: 4px;
        }

        #panelList::-webkit-scrollbar-thumb {
            background: var(--scrollbar-color);
            border-radius: 4px;
        }

        #panelList::-webkit-scrollbar-thumb:hover {
            background: var(--primary-hover);
        }

        #panelList li {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: clamp(8px, 2vw, 10px) clamp(10px, 3vw, 15px);
            background-color: var(--input-bg);
            border-radius: 8px;
            transition: background-color 0.2s ease;
            width: 100%;
            box-sizing: border-box;
        }

        #panelList li:hover {
            background-color: var(--hover-bg);
        }

        #panelList li span {
            flex-grow: 1;
            margin-bottom: clamp(6px, 2vw, 10px);
            font-size: min(0.95em, 2.8vw);
        }

        #panelList li div {
            display: flex;
            gap: clamp(6px, 2vw, 10px);
        }

        #panelList li button {
            padding: clamp(6px, 2vw, 8px);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: #fff;
            transition: background-color 0.2s ease;
            font-size: min(0.9em, 2.5vw);
            flex: 1;
        }

        #panelList li button:first-of-type {
            background-color: var(--primary-color);
        }

        #panelList li button:first-of-type:hover {
            background-color: var(--primary-hover);
        }

        #panelList li button:last-of-type {
            background-color: var(--toast-error);
        }

        #panelList li button:last-of-type:hover {
            background-color: #c82333;
        }

        #summary {
            display: flex;
            gap: clamp(10px, 3vw, 20px);
            justify-content: center;
            margin: clamp(10px, 3vw, 20px) 0;
        }

        .summary-card {
            background-color: var(--bg-color);
            padding: clamp(10px, 3vw, 15px);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            flex: 1;
            min-width: 150px;
            transition: background-color 0.3s;
        }

        .summary-card h3 {
            margin: 0;
            font-size: min(1.2em, 3.5vw);
            color: var(--text-color);
        }

        .summary-card p {
            font-size: min(1.5em, 4.5vw);
            font-weight: bold;
            color: var(--primary-color);
        }

        #filters {
            display: flex;
            gap: clamp(6px, 2vw, 10px);
            margin: clamp(10px, 3vw, 20px) 0;
        }

        #filters input {
            padding: clamp(8px, 2vw, 10px);
            border-radius: 5px;
            border: 1px solid var(--border-color);
            flex-grow: 1;
            font-size: min(1em, 3vw);
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .top-actions {
            display: flex;
            gap: clamp(6px, 2vw, 10px);
            justify-content: center;
            margin: clamp(10px, 3vw, 20px) auto;
            flex-wrap: wrap;
        }

        #new-client-btn, #theme-toggle-btn, #panel-manager-btn, #message-manager-btn {
            padding: clamp(10px, 3vw, 15px) clamp(20px, 5vw, 40px);
            border: none;
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-size: min(1.2em, 3.5vw);
            width: clamp(150px, 30%, 300px);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: clamp(6px, 2vw, 8px);
        }

        #new-client-btn {
            background-color: var(--primary-color);
        }

        #new-client-btn:hover {
            background-color: var(--primary-hover);
        }

        #theme-toggle-btn {
            background-color: var(--theme-btn-color);
        }

        #theme-toggle-btn:hover {
            background-color: var(--theme-btn-hover);
        }

        #panel-manager-btn {
            background-color: var(--panel-btn-color);
        }

        #panel-manager-btn:hover {
            background-color: var(--panel-btn-hover);
        }

        #message-manager-btn {
            background-color: var(--msg-btn-color);
        }

        #message-manager-btn:hover {
            background-color: var(--msg-btn-hover);
        }

        .toast {
            position: fixed;
            bottom: clamp(10px, 3vw, 20px);
            right: clamp(10px, 3vw, 20px);
            padding: clamp(8px, 2vw, 10px) clamp(15px, 4vw, 20px);
            border-radius: 5px;
            color: #fff;
            z-index: 2000;
            animation: slideIn 0.3s ease;
            font-size: min(0.9em, 2.8vw);
        }

        .toast.success {
            background-color: var(--toast-success);
        }

        .toast.error {
            background-color: var(--toast-error);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: clamp(20px, 5vw, 24px);
            height: clamp(20px, 5vw, 24px);
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .chart-container {
            max-width: 100%;
            margin: 0 auto;
            padding: clamp(10px, 3vw, 20px) 0;
        }

        #clientsChart {
            max-width: 100%;
            width: 100%;
            max-height: clamp(300px, 80vw, 400px);
        }

        .animate-on-scroll {
            opacity: 0;
            transform: translateY(200px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .animate-on-scroll.visible {
            opacity: 1;
            transform: translateY(0);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .variables-info {
            padding: clamp(10px, 2.5vw, 15px);
            background-color: var(--input-bg);
            border-radius: 8px;
            margin-bottom: clamp(10px, 2.5vw, 15px);
            font-size: min(0.95em, 2.8vw);
        }

        .variables-info p {
            margin: 0 0 clamp(8px, 2vw, 10px);
            color: var(--text-color);
        }

        .variables-info .variable-item {
            display: flex;
            align-items: center;
            gap: clamp(6px, 1.5vw, 8px);
            padding: clamp(6px, 1.5vw, 8px);
            background-color: var(--variable-bg);
            border-radius: 5px;
            margin: clamp(4px, 1vw, 6px);
            font-size: min(0.9em, 2.5vw);
            transition: background-color 0.3s;
        }

        .variables-info .variable-item i {
            color: var(--panel-btn-color);
            font-size: min(1em, 3vw);
        }

        @media (prefers-reduced-motion: reduce) {
            .group-content, .client-details, .animate-on-scroll {
                transition: none;
                animation: none;
            }
        }

        @media (max-width: 768px) {
            #summary {
                flex-direction: column;
            }

            .summary-card {
                min-width: 100%;
            }

            .client-row {
                flex-direction: column;
                align-items: flex-start;
                gap: clamp(6px, 2vw, 8px);
            }

            .client-info {
                flex-direction: column;
                align-items: flex-start;
            }

            .client-actions {
                width: 100%;
                justify-content: flex-start;
            }

            .modal-content {
                width: 95%;
                max-width: 95%;
            }

            .modal-body {
                padding: clamp(12px, 3vw, 15px);
            }

            .input-group i {
                font-size: min(1em, 3vw);
            }

            .modal-content input, .modal-content select, .modal-content textarea {
                padding: clamp(8px, 2vw, 10px) clamp(8px, 2vw, 10px) clamp(8px, 2vw, 10px) clamp(25px, 6vw, 30px);
            }

            .modal-content button[type="submit"] {
                width: 100%;
                padding: clamp(8px, 2vw, 10px);
            }

            #new-client-btn, #theme-toggle-btn, #panel-manager-btn, #message-manager-btn {
                width: 100%;
                padding: clamp(8px, 2vw, 12px) clamp(15px, 4vw, 20px);
                font-size: min(1em, 3vw);
            }

            #panelList {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            #clientsChart {
                max-height: 300px;
            }

            .variables-info .variable-item {
                flex: 1 1 45%;
            }

            .client-count {
                font-size: min(0.8em, 2.3vw);
                padding: clamp(2px, 0.5vw, 3px) clamp(6px, 1.5vw, 8px);
            }
        }

        @media (max-width: 480px) {
            .summary-card h3 {
                font-size: min(0.9em, 2.8vw);
            }

            .summary-card p {
                font-size: min(1.2em, 3.5vw);
            }

            .summary-card {
                padding: clamp(8px, 2vw, 10px);
            }

            .client-row {
                padding: clamp(6px, 1.5vw, 8px) clamp(8px, 2vw, 12px);
            }

            .client-info span, .client-info .due-date {
                font-size: min(0.85em, 2.5vw);
            }

            .client-details {
                font-size: min(0.9em, 2.5vw);
                padding: clamp(6px, 1.5vw, 8px) clamp(10px, 2.5vw, 16px);
            }

            .whatsapp-btn, .renew-btn {
                padding: clamp(3px, 1vw, 4px) clamp(5px, 1.5vw, 8px);
                font-size: min(0.8em, 2.2vw);
            }

            .modal-header {
                padding: clamp(8px, 2vw, 10px) clamp(12px, 3vw, 15px);
            }

            .modal-header h2 {
                font-size: min(1.2em, 4vw);
            }

            .modal-content input, .modal-content select, .modal-content textarea {
                font-size: min(0.85em, 2.5vw);
                padding: clamp(6px, 1.5vw, 8px) clamp(6px, 1.5vw, 8px) clamp(6px, 1.5vw, 8px) clamp(20px, 5vw, 25px);
            }

            .modal-content button[type="submit"] {
                font-size: min(0.9em, 2.8vw);
            }

            .modal-content button[type="submit"] i {
                font-size: min(0.8em, 2.5vw);
            }

            .close-btn {
                width: clamp(20px, 5vw, 25px);
                height: clamp(20px, 5vw, 25px);
                font-size: min(1.2em, 3.5vw);
            }

            #filters input {
                font-size: min(0.9em, 2.5vw);
                padding: clamp(6px, 1.5vw, 8px);
            }

            #panelList {
                grid-template-columns: 1fr;
            }

            #panelList li span {
                font-size: min(0.9em, 2.5vw);
            }

            #panelList li button {
                padding: clamp(4px, 1.5vw, 6px);
                font-size: min(0.85em, 2.3vw);
            }

            #clientsChart {
                max-height: 200px;
            }

            .toast {
                padding: clamp(6px, 1.5vw, 8px) clamp(10px, 3vw, 15px);
                font-size: min(0.85em, 2.5vw);
            }

            .variables-info .variable-item {
                flex: 1 1 100%;
            }

            .client-count {
                font-size: min(0.75em, 2vw);
                padding: clamp(1px, 0.3vw, 2px) clamp(5px, 1.2vw, 6px);
            }
        }
        
        i{ 
            font-size: 1.5em;
        }
    </style>
</head>
<body>
    
    <button id="logoutButton" class="mt-4 bg-red-600 text-white p-2 rounded-md hover:bg-red-700 transition">Sair</button>
    
    <div id="welcomeMessage"></div>
    
    <div id="summary" class="animate-on-scroll">
        <div class="summary-card">
            <h3>Total de Clientes</h3>
            <p id="totalClients">0</p>
        </div>
        <div class="summary-card">
            <h3>Valor Total</h3>
            <p id="totalValue">0</p>
        </div>
    </div>

       <!-- Gr√°fico -->
    <canvas id="clientsChart" style="max-width: 600px; margin: 20px auto;"></canvas>
    

    <div class="top-actions animate-on-scroll">
        <button id="new-client-btn" onclick="openModal()">
            <i class="fas fa-plus"></i> Novo Cliente
        </button>
        <button id="theme-toggle-btn" onclick="toggleTheme()" aria-label="Alternar para tema escuro">
            <i class="fas fa-moon"></i>Theme Color
        </button>
        <button id="panel-manager-btn" onclick="openPanelManager()">
            <i class="fas fa-cog"></i> Gerenciar Pain√©is
        </button>
        <button id="message-manager-btn" onclick="openMessageManager()" aria-label="Gerenciar mensagens do WhatsApp">
            <i class="fas fa-comment-alt"></i> Gerenciar Mensagens
        </button>
    </div>

    <div id="filters" class="animate-on-scroll">
        <input type="text" id="search" placeholder="Pesquisar cliente, WhatsApp ou painel...">
    </div>

    <div id="clientTable" class="animate-on-scroll">
        <div id="categories">
            <div class="group-header vencidos" onclick="toggleGroup('vencidos')">
                <span>Vencidos <span class="client-count" id="vencidos-count">0</span></span>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div id="vencidos-group" class="group-content"></div>

            <div class="group-header vencendo" onclick="toggleGroup('vencendo')">
                <span>Vencendo (pr√≥ximos 3 dias) <span class="client-count" id="vencendo-count">0</span></span>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div id="vencendo-group" class="group-content"></div>

            <div class="group-header em-dia" onclick="toggleGroup('em-dia')">
                <span>Em Dia <span class="client-count" id="em-dia-count">0</span></span>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div id="em-dia-group" class="group-content"></div>
        </div>
        <div id="todos-group" style="display: none;">
            <div class="group-header todos" onclick="toggleGroup('todos')">
                <span>Todos os Clientes <span class="client-count" id="todos-count">0</span></span>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div id="todos-content" class="group-content"></div>
        </div>
    </div>

    <div id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Novo Cliente</h2>
                <i class="fas fa-times close-btn" onclick="closeModal()"></i>
            </div>
            <div class="modal-body">
                <form id="clientForm">
                    <div class="input-group">
                        <i class="fas fa-user"></i>
                        <input type="text" id="cliente" placeholder="Nome do Cliente" required>
                    </div>
                    <div class="input-group">
                        <i class="fas fa-tv"></i>
                        <input type="text" id="tela" placeholder="Tela" required>
                    </div>
                    <div class="input-group">
                        <i class="fas fa-percent"></i>
                        <input type="number" id="desconto" placeholder="Desconto (%)">
                    </div>
                    <div class="input-group">
                        <i class="fas fa-dollar-sign"></i>
                        <input type="number" id="valor" placeholder="Valor" required>
                    </div>
                    <div class="input-group">
                        <i class="fab fa-whatsapp"></i>
                        <input type="text" id="whats" placeholder="WhatsApp" required>
                    </div>
                    <div class="input-group">
                        <i class="fas fa-server"></i>
                        <select id="painel" required>
                            <option value="">Selecione um painel</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <i class="fas fa-network-wired"></i>
                        <input type="text" id="mac" placeholder="MAC">
                    </div>
                    <div class="input-group">
                        <i class="fas fa-key"></i>
                        <input type="text" id="safekey" placeholder="SafeKey">
                    </div>
                    <div class="input-group">
                        <i class="fas fa-comment"></i>
                        <textarea id="observacoes" placeholder="Observa√ß√µes"></textarea>
                    </div>
                    <div class="input-group">
                        <i class="fas fa-calendar"></i>
                        <input type="date" id="vencimento" required>
                    </div>
                    <button type="submit"><i class="fas fa-check"></i> Salvar</button>
                </form>
            </div>
        </div>
    </div>

    <div id="panelManagerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Gerenciar Pain√©is</h2>
                <i class="fas fa-times close-btn" onclick="closePanelManager()"></i>
            </div>
            <div class="modal-body">
                <form id="panelForm">
                    <input type="hidden" id="panelId">
                    <div class="input-group">
                        <i class="fas fa-tag"></i>
                        <input type="text" id="panelName" placeholder="Nome do Painel" required>
                    </div>
                    <div class="input-group">
                        <i class="fas fa-link"></i>
                        <input type="url" id="panelLink" placeholder="Link do Painel" required>
                    </div>
                    <button type="submit"><i class="fas fa-save"></i> Salvar Painel</button>
                </form>
                <ul id="panelList"></ul>
            </div>
        </div>
    </div>

    <div id="messageManagerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Gerenciar Mensagens</h2>
                <i class="fas fa-times close-btn" onclick="closeMessageManager()"></i>
            </div>
            <div class="modal-body">
                <div class="variables-info" tabindex="0" aria-label="Informa√ß√µes sobre vari√°veis dispon√≠veis">
                    <p>Use estas vari√°veis nas mensagens abaixo. Exemplo: {cliente}</p>
                    <div id="variables-list" style="display: flex; flex-wrap: wrap; gap: clamp(8px, 2vw, 10px);"></div>
                </div>
                <form id="messageForm">
                    <div class="input-group">
                        <i class="fas fa-exclamation-circle"></i>
                        <textarea id="dueMessage" placeholder="Mensagem de vencimento. Exemplo: Ol√° {cliente}, seu plano vence em {formattedDate} por R${valor}." required></textarea>
                    </div>
                    <div class="input-group">
                        <i class="fas fa-sync"></i>
                        <textarea id="renewalMessage" placeholder="Mensagem de renova√ß√£o. Exemplo: Ol√° {cliente}, plano renovado at√© {formattedDate}." required></textarea>
                    </div>
                    <button type="submit"><i class="fas fa-save"></i> Salvar Mensagens</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        const API_URL = "https://66d39f5c184dce1713d09736.mockapi.io/Api/v1/clientes";
        const PANELS_API_URL = "https://66d39f5c184dce1713d09736.mockapi.io/Api/v1/paineis";
        let clients = [];
        let editingIndex = null;
        let openDetail = null;
        let isSaving = false;
        let chartInstance = null;
        const chartType = 'bar';

        document.addEventListener("DOMContentLoaded", () => {
            loadClients();
            setupFilters();
            fetchPanels();
            loadTheme();
            updateThemeIcon();
            updateWhatsAppMessages();
            setupScrollAnimations();
        });

        const form = document.getElementById("clientForm");
        const clientTable = document.getElementById("clientTable");
        const searchInput = document.getElementById("search");
        const categories = document.getElementById("categories");
        const todosGroup = document.getElementById("todos-group");
        const themeToggleBtn = document.getElementById("theme-toggle-btn");

        async function loadClients() {
            clientTable.querySelectorAll(".group-content").forEach(group => {
                group.innerHTML = '<div style="padding: clamp(8px, 2vw, 12px) clamp(10px, 3vw, 16px)"><div class="loader"></div></div>';
            });
            try {
                const response = await fetch(API_URL);
                clients = await response.json();
                clients.sort((a, b) => new Date(a.vencimento) - new Date(b.vencimento));
                renderClients(clients);
            } catch (e) {
                console.error("Erro ao carregar os clientes:", e);
                clientTable.querySelectorAll(".group-content").forEach(group => {
                    group.innerHTML = '<div style="padding: clamp(10px, 3vw, 16px)">Erro ao carregar os dados.</div>';
                });
                showToast("Erro ao carregar clientes.", "error");
            }
        }

        async function renderClients(clients) {
            const paineis = await fetchPaineis();
            const vencidosGroup = document.getElementById("vencidos-group");
            const vencendoGroup = document.getElementById("vencendo-group");
            const emDiaGroup = document.getElementById("em-dia-group");
            const todosContent = document.getElementById("todos-content");

            vencidosGroup.innerHTML = "";
            vencendoGroup.innerHTML = "";
            emDiaGroup.innerHTML = "";
            todosContent.innerHTML = "";

            const now = new Date();
            const vencidos = [];
            const vencendo = [];
            const emDia = [];

            clients.forEach(client => {
                const dueDate = new Date(client.vencimento);
                const daysDiff = Math.round((dueDate - now) / (1000 * 60 * 60 * 24));
                if (daysDiff < 0) {
                    vencidos.push(client);
                } else if (daysDiff <= 3) {
                    vencendo.push(client);
                } else {
                    emDia.push(client);
                }
            });

            const dueMessageTemplate = localStorage.getItem('dueMessageTemplate') || `Ol√° {cliente}, tudo bem? üòä\n\nüö® Para evitar qualquer interrup√ß√£o no seu acesso, lembramos que seu plano vence em {formattedDate} √†s 23:59.\n\nüìÖ Fa√ßa o pagamento de R${{valor}} via Pix para o n√∫mero 11915370708.\n\nüí≥ Ap√≥s o pagamento, envie o comprovante e continue aproveitando sem preocupa√ß√µes!\n\nAgradecemos pela confian√ßa! üíô`;

            const renderClient = (client, isSearch = false) => {
                const dueDate = new Date(client.vencimento);
                const daysDiff = Math.round((dueDate - now) / (1000 * 60 * 60 * 24));
                const formattedDate = formatDate(client.vencimento);
                const dueMessage = dueMessageTemplate
                    .replace('{cliente}', client.cliente)
                    .replace('{formattedDate}', formattedDate)
                    .replace('{valor}', client.valor);
                const foundPanel = paineis.find(p => p.id === client.painel);
                const actionButtons = daysDiff <= 3 ? `
                    <a href="https://wa.me/55${client.whats}?text=${encodeURIComponent(dueMessage)}" target="_blank" class="whatsapp-btn" aria-label="Enviar lembrete de vencimento via WhatsApp"><i class="fab fa-whatsapp"></i></a>
                    <a href="#" onclick="renewClient('${client.id}'); return false;" class="renew-btn" aria-label="Renovar cliente"><i class="fas fa-sync"></i></a>
                ` : '';

                return `
                    <div class="client-row" ${!isSearch ? `onclick="toggleDetails('${client.id}')"` : ''}>
                        <div class="client-info">
                            <span>${client.cliente}</span>
                            <span class="due-date">Vence: ${formattedDate}</span>
                        </div>
                        <div class="client-actions">${actionButtons}</div>
                    </div>
                    <div id="details-${client.id}" class="client-details ${isSearch ? 'open' : ''}">
                        <p><strong>Tela:</strong> ${client.tela}</p>
                        <p><strong>Valor:</strong> R$ ${client.valor}</p>
                        <p><strong>Vencimento:</strong> ${formattedDate}</p>
                        <p><strong>Painel:</strong> ${foundPanel ? `<a href="${foundPanel.link}" target="_blank">${foundPanel.nome}</a>` : "Painel n√£o encontrado"}</p>
                        <p><strong>MAC:</strong> ${client.mac || '-'} <br><strong>Key:</strong> ${client.safekey || '-'}</p>
                        <p><strong>Observa√ß√µes:</strong><br><textarea readonly>${client.observacoes || '-'}</textarea></p>
                        <div class="actions">
                            <button onclick="openModal('${client.id}')"><i class="fas fa-edit"></i> Editar</button>
                            <button onclick="deleteClient('${client.id}')"><i class="fas fa-trash"></i> Excluir</button>
                            <a href="https://wa.me/55${client.whats}" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp</a>
                            <a href="#" onclick="renewClient('${client.id}'); return false;"><i class="fas fa-sync"></i> Renovar</a>
                            ${daysDiff <= 3 ? `<a href="https://wa.me/55${client.whats}?text=${encodeURIComponent(dueMessage)}" target="_blank" class="due-alert"><i class="fas fa-exclamation-circle"></i> Vencimento</a>` : ""}
                        </div>
                    </div>`;
            };

            const renderGroup = (clients, container, isSearch = false) => {
                clients.forEach(client => {
                    container.innerHTML += renderClient(client, isSearch);
                });
            };

            renderGroup(vencidos, vencidosGroup);
            renderGroup(vencendo, vencendoGroup);
            renderGroup(emDia, emDiaGroup);

            // Atualizar contagens
            document.getElementById("vencidos-count").textContent = vencidos.length;
            document.getElementById("vencendo-count").textContent = vencendo.length;
            document.getElementById("em-dia-count").textContent = emDia.length;

            const searchTerm = searchInput.value.trim();
            if (searchTerm !== "") {
                categories.style.display = "none";
                todosGroup.style.display = "block";
                todosContent.classList.add("open");
                const filteredClients = clients.filter(client =>
                    client.cliente.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    client.whats.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    client.painel.toLowerCase().includes(searchTerm.toLowerCase())
                );
                renderGroup(filteredClients, todosContent, true);
                document.getElementById("todos-count").textContent = filteredClients.length;
            } else {
                categories.style.display = "block";
                todosGroup.style.display = "none";
                todosContent.classList.remove("open");
                document.getElementById("todos-count").textContent = clients.length;
            }

            renderSummary();
            renderChart();
        }

        async function fetchPaineis() {
            try {
                const response = await fetch(PANELS_API_URL);
                return await response.json();
            } catch (e) {
                console.error("Erro ao buscar pain√©is:", e);
                showToast("Erro ao buscar pain√©is.", "error");
                return [];
            }
        }

        function toggleGroup(groupId) {
            const group = document.getElementById(`${groupId}-group`) || document.getElementById("todos-content");
            group.classList.toggle("open");
            const header = document.querySelector(`.group-header.${groupId}`);
            if (header) {
                const icon = header.querySelector(".fas");
                icon.classList.toggle("fa-chevron-down");
                icon.classList.toggle("fa-chevron-up");
            }
        }

        function toggleDetails(clientId) {
            const details = document.getElementById(`details-${clientId}`);
            if (openDetail !== null && openDetail !== clientId) {
                document.getElementById(`details-${openDetail}`).classList.remove("open");
            }
            details.classList.toggle("open");
            openDetail = details.classList.contains("open") ? clientId : null;
            event.stopPropagation();
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr + "T00:00:00");
            return new Intl.DateTimeFormat("pt-BR", {
                day: "2-digit",
                month: "2-digit",
                year: "numeric",
                timeZone: "America/Sao_Paulo"
            }).format(date);
        }

        function setupFilters() {
            searchInput.addEventListener("input", () => {
                renderClients(clients);
            });
        }

        function openModal(clientId = null) {
            document.getElementById("modalTitle").textContent = clientId ? "Editar Cliente" : "Novo Cliente";
            if (clientId !== null) {
                const client = clients.find(c => c.id === clientId);
                if (!client) {
                    showToast("Cliente n√£o encontrado!", "error");
                    return;
                }
                editingIndex = clients.findIndex(c => c.id === clientId);
                Object.keys(client).forEach(key => {
                    const input = document.getElementById(key);
                    if (input) input.value = client[key];
                });
            } else {
                editingIndex = null;
                form.reset();
            }
            document.getElementById("modal").style.display = "flex";
        }

        function closeModal() {
            document.getElementById("modal").style.display = "none";
        }

        form.addEventListener("submit", async function (e) {
            e.preventDefault();
            if (isSaving) return;
            isSaving = true;
            await saveClient();
            isSaving = false;
            closeModal();
        });

        async function saveClient() {
            const client = {
                cliente: document.getElementById("cliente").value,
                tela: document.getElementById("tela").value,
                desconto: parseFloat(document.getElementById("desconto").value) || 0,
                valor: parseFloat(document.getElementById("valor").value) || 0,
                whats: document.getElementById("whats").value,
                painel: document.getElementById("painel").value,
                mac: document.getElementById("mac").value,
                safekey: document.getElementById("safekey").value,
                observacoes: document.getElementById("observacoes").value,
                vencimento: document.getElementById("vencimento").value,
            };
            client.valor = (client.valor * (1 - client.desconto / 100)).toFixed(2);
            if (isNaN(client.valor) || client.valor <= 0) {
                showToast("Por favor, insira um valor v√°lido.", "error");
                return;
            }
            if (!client.cliente) {
                showToast("O campo Nome do Cliente √© obrigat√≥rio.", "error");
                return;
            }
            if (!client.tela) {
                showToast("O campo Tela √© obrigat√≥rio.", "error");
                return;
            }
            if (!client.whats) {
                showToast("O campo WhatsApp √© obrigat√≥rio.", "error");
                return;
            }
            if (!client.painel) {
                showToast("O campo Painel √© obrigat√≥rio.", "error");
                return;
            }
            if (!client.vencimento) {
                showToast("O campo Vencimento √© obrigat√≥rio.", "error");
                return;
            }
            try {
                const method = editingIndex !== null ? 'PUT' : 'POST';
                const url = editingIndex !== null ? `${API_URL}/${clients[editingIndex].id}` : API_URL;
                await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(client)
                });
                showToast("Cliente salvo com sucesso!", "success");
                await loadClients();
            } catch (e) {
                console.error('Erro ao salvar cliente:', e);
                showToast("Erro ao salvar cliente.", "error");
            }
        }

        async function deleteClient(clientId) {
            if (!confirm("Tem certeza que deseja excluir este cliente? A exclus√£o ser√° permanente!")) return;
            try {
                const response = await fetch(`${API_URL}/${clientId}`, { method: 'DELETE' });
                if (!response.ok) {
                    throw new Error(`Erro na API: ${response.status}`);
                }
                clients = clients.filter(client => client.id !== clientId);
                renderClients(clients);
                showToast("Cliente exclu√≠do com sucesso!", "success");
            } catch (e) {
                console.error("Erro ao excluir cliente:", e);
                showToast("Erro ao excluir cliente.", "error");
            }
        }

        async function renewClient(clientId) {
            const client = clients.find(c => c.id === clientId);
            if (!client) {
                showToast("Cliente n√£o encontrado!", "error");
                return;
            }
            let monthsToAdd = prompt("Quantos meses deseja adicionar √† renova√ß√£o?", "1");
            monthsToAdd = parseInt(monthsToAdd);
            if (isNaN(monthsToAdd) || monthsToAdd <= 0) {
                showToast("Por favor, insira um n√∫mero v√°lido de meses.", "error");
                return;
            }
            let updatedClient = { ...client };
            let currentDate = new Date(updatedClient.vencimento);
            let originalDay = currentDate.getDate();
            currentDate.setMonth(currentDate.getMonth() + monthsToAdd);
            if (currentDate.getDate() !== originalDay) {
                currentDate.setDate(0);
            }
            updatedClient.vencimento = currentDate.toISOString().slice(0, 10);
            try {
                await fetch(`${API_URL}/${updatedClient.id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedClient)
                });
                await loadClients();
                const formattedDate = formatDate(updatedClient.vencimento);
                const renewalMessageTemplate = localStorage.getItem('renewalMessageTemplate') || `Ol√° {cliente}, tudo bem? üòé\n\n‚úÖ Seu plano foi renovado com sucesso!\n\nüìÖ *Pr√≥ximo vencimento: {formattedDate}.*\n\nObrigado por continuar com a gente! üöÄ`;
                const renewalMessage = renewalMessageTemplate
                    .replace('{cliente}', updatedClient.cliente)
                    .replace('{formattedDate}', formattedDate);
                window.open(`https://wa.me/55${updatedClient.whats}?text=${encodeURIComponent(renewalMessage)}`, "_blank");
                showToast("Cliente renovado com sucesso!", "success");
            } catch (e) {
                console.error("Erro ao renovar cliente:", e);
                showToast("Erro ao renovar cliente.", "error");
            }
        }

        function openPanelManager() {
            document.getElementById('panelManagerModal').style.display = 'flex';
            fetchPanels();
        }

        function closePanelManager() {
            document.getElementById('panelManagerModal').style.display = 'none';
        }

        async function fetchPanels() {
            try {
                const response = await fetch(PANELS_API_URL);
                const data = await response.json();
                updatePanelList(data);
                updatePanelSelect(data);
            } catch (e) {
                console.error("Erro ao buscar pain√©is:", e);
                showToast("Erro ao carregar pain√©is.", "error");
            }
        }

        function updatePanelList(paineis) {
            const panelList = document.getElementById('panelList');
            panelList.innerHTML = "";
            paineis.forEach(panel => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>${panel.nome} - <a href="${panel.link}" target="_blank">${panel.link}</a></span>
                    <div>
                        <button onclick="editPanel('${panel.id}', '${panel.nome}', '${panel.link}')"><i class="fas fa-edit"></i></button>
                        <button onclick="deletePanel('${panel.id}')"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                panelList.appendChild(li);
            });
        }

        function updatePanelSelect(paineis) {
            const panelSelect = document.getElementById('painel');
            panelSelect.innerHTML = `<option value="">Selecione um painel</option>`;
            paineis.forEach(panel => {
                const option = document.createElement('option');
                option.value = panel.id;
                option.textContent = panel.nome;
                panelSelect.appendChild(option);
            });
        }

        document.getElementById('panelForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const id = document.getElementById('panelId').value;
            const nome = document.getElementById('panelName').value;
            const link = document.getElementById('panelLink').value;
            const panelData = { nome, link };
            try {
                if (id) {
                    await fetch(`${PANELS_API_URL}/${id}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(panelData),
                    });
                } else {
                    await fetch(PANELS_API_URL, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(panelData),
                    });
                }
                document.getElementById('panelForm').reset();
                document.getElementById('panelId').value = '';
                fetchPanels();
                showToast("Painel salvo com sucesso!", "success");
            } catch (e) {
                console.error("Erro ao salvar painel:", e);
                showToast("Erro ao salvar painel.", "error");
            }
        });

        function editPanel(id, nome, link) {
            document.getElementById('panelId').value = id;
            document.getElementById('panelName').value = nome;
            document.getElementById('panelLink').value = link;
        }

        async function deletePanel(id) {
            if (confirm("Tem certeza que deseja excluir este painel?")) {
                try {
                    await fetch(`${PANELS_API_URL}/${id}`, { method: "DELETE" });
                    fetchPanels();
                    showToast("Painel exclu√≠do com sucesso!", "success");
                } catch (e) {
                    console.error("Erro ao excluir painel:", e);
                    showToast("Erro ao excluir painel.", "error");
                }
            }
        }

        function renderSummary() {
            const totalClients = clients.length;
            const totalValue = clients.reduce((sum, client) => sum + parseFloat(client.valor || 0), 0).toFixed(2);
            document.getElementById("totalClients").textContent = totalClients;
            document.getElementById("totalValue").textContent = `R$ ${totalValue}`;
        }

        function renderChart() {
            const ctx = document.getElementById("clientsChart").getContext('2d');
            if (chartInstance) {
                chartInstance.destroy();
            }
            const months = ["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
            const clientCounts = months.map((_, index) => {
                return clients.filter(client => {
                    const date = new Date(client.vencimento);
                    return date.getMonth() === index && date.getFullYear() === new Date().getFullYear();
                }).length;
            });
            const chartConfig = {
                type: chartType,
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Total de Clientes',
                        data: clientCounts,
                        backgroundColor: 'var(--primary-color)',
                        borderColor: 'var(--primary-hover)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    size: window.innerWidth < 480 ? 10 : 12
                                }
                            }
                        }
                    }
                }
            };
            chartInstance = new Chart(ctx, chartConfig);
        }

        function setupScrollAnimations() {
            const elements = document.querySelectorAll('.animate-on-scroll');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });
            elements.forEach(element => observer.observe(element));
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2000);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon();
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        }

        function updateThemeIcon() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const icon = themeToggleBtn.querySelector('i');
            if (currentTheme === 'dark') {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                themeToggleBtn.setAttribute('aria-label', 'Alternar para tema claro');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                themeToggleBtn.setAttribute('aria-label', 'Alternar para tema escuro');
            }
        }

        function renderVariablesInfo() {
            const variablesList = document.getElementById('variables-list');
            variablesList.innerHTML = '';
            const fixedVariables = [
                { name: '{cliente}', description: 'Nome do cliente', icon: 'fa-user' },
                { name: '{formattedDate}', description: 'Data de vencimento (DD/MM/AAAA)', icon: 'fa-calendar' },
                { name: '{valor}', description: 'Valor do plano (usado apenas em vencimento)', icon: 'fa-dollar-sign' },
            ];
            const otherVariables = [];
            const allVariables = [...fixedVariables, ...otherVariables];
            allVariables.forEach(v => {
                const div = document.createElement('div');
                div.className = 'variable-item';
                div.innerHTML = `<i class="fas ${v.icon}"></i><span><strong>${v.name}</strong>: ${v.description}</span>`;
                variablesList.appendChild(div);
            });
        }

        function openMessageManager() {
            const dueMessage = localStorage.getItem('dueMessageTemplate') || `Ol√° {cliente}, tudo bem? üòä\n\nüö® Para evitar qualquer interrup√ß√£o no seu acesso, lembramos que seu plano vence em {formattedDate} √†s 23:59.\n\nüìÖ Fa√ßa o pagamento de R${{valor}} via Pix para o n√∫mero 11915370708.\n\nüí≥ Ap√≥s o pagamento, envie o comprovante e continue aproveitando sem preocupa√ß√µes!\n\nAgradecemos pela confian√ßa! üíô`;
            const renewalMessage = localStorage.getItem('renewalMessageTemplate') || `Ol√° {cliente}, tudo bem? üòé\n\n‚úÖ Seu plano foi renovado com sucesso!\n\nüìÖ *Pr√≥ximo vencimento: {formattedDate}.*\n\nObrigado por continuar com a gente! üöÄ`;
            document.getElementById('dueMessage').value = dueMessage;
            document.getElementById('renewalMessage').value = renewalMessage;
            renderVariablesInfo();
            document.getElementById('messageManagerModal').style.display = 'flex';
        }

        function closeMessageManager() {
            document.getElementById('messageManagerModal').style.display = 'none';
        }

        function updateWhatsAppMessages() {
            const messageForm = document.getElementById('messageForm');
            messageForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const dueMessage = document.getElementById('dueMessage').value;
                const renewalMessage = document.getElementById('renewalMessage').value;
                if (!dueMessage || !renewalMessage) {
                    showToast("Por favor, preencha todas as mensagens.", "error");
                    return;
                }
                localStorage.setItem('dueMessageTemplate', dueMessage);
                localStorage.setItem('renewalMessageTemplate', renewalMessage);
                showToast("Mensagens salvas com sucesso!", "success");
                closeMessageManager();
                renderClients(clients);
            });
        }
    </script>


<script>
// Fun√ß√£o para formatar a data e hora
  function formatDateTime() {
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0'); // +1 porque meses come√ßam em 0
    const year = now.getFullYear();
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const seconds = String(now.getSeconds()).padStart(2, '0');
    return `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
  }

  // Fun√ß√£o para atualizar a mensagem de boas-vindas
  function updateWelcomeMessage(username) {
    document.getElementById('welcomeMessage').textContent = 
      `Bem vindo ${username} - ${formatDateTime()}`;
  }

  // Fun√ß√£o para verificar o token
  async function verifyToken() {
    const token = localStorage.getItem('authToken');
    if (!token) {
      window.location.href = 'index.html';
      return;
    }

    try {
      const response = await fetch('/api/verify', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token })
      });

      const result = await response.json();
      if (!result.valid) {
        localStorage.removeItem('authToken');
        window.location.href = 'index.html';
      } else {
        // Token v√°lido, inicia a atualiza√ß√£o em tempo real
        updateWelcomeMessage(result.username);
        setInterval(() => updateWelcomeMessage(result.username), 1000);
      }
    } catch (error) {
      console.error('Erro ao verificar token:', error);
      localStorage.removeItem('authToken');
      window.location.href = 'index.html';
    }
  }

  // Verifica o token ao carregar a p√°gina
  verifyToken();

  // Logout
  document.getElementById('logoutButton').addEventListener('click', () => {
    localStorage.removeItem('authToken');
    window.location.href = 'index.html';
  });
</script>
    
</body>
</html>